apiVersion: kro.run/v1alpha1
kind: ResourceGraphDefinition
metadata:
  annotations:
    chart2kro.dev/generated: "true"
  labels:
    app.kubernetes.io/managed-by: chart2kro
    app.kubernetes.io/name: with-hooks
    app.kubernetes.io/version: 1.0.0
  name: with-hooks
spec:
  resources:
  - id: configmap
    template:
      apiVersion: v1
      data:
        key: value
      kind: ConfigMap
      metadata:
        name: release-config
  - id: job
    readyWhen:
    - ${self.status.succeeded > 0}
    template:
      apiVersion: batch/v1
      kind: Job
      metadata:
        name: release-migrate
      spec:
        template:
          spec:
            containers:
            - command:
              - sh
              - -c
              - echo migrating
              image: ${schema.spec.image}
              name: migrate
            restartPolicy: Never
  - id: pod
    template:
      apiVersion: v1
      kind: Pod
      metadata:
        name: release-test
      spec:
        containers:
        - command:
          - sh
          - -c
          - echo test
          image: ${schema.spec.image}
          name: test
        restartPolicy: Never
  schema:
    apiVersion: with-hooks.kro.run/v1alpha1
    kind: WithHooks
    spec:
      image: string | default="busybox"
    status:
      jobCompletionTime: ${job.status.?completionTime}
      jobFailed: ${job.status.failed}
      jobSucceeded: ${job.status.succeeded}
